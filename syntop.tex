\documentclass{article}
\input{decls}
\usepackage[status=draft]{fixme}
\title{Unifying constructive general topology}
\author{Toby Bartels and Michael Shulman}
\def\R{\mathbb{R}}
\def\Re{\overline{\mathbb{R}}}
\def\Rp{[0,\infty]}
%\def\Rpf{[0,\infty)}
\def\F{\mathcal{F}}
\def\apart{\mathrel{\#}}
\begin{document}
\maketitle

\section{Introduction}
\label{sec:intro}

\section{Metric, gauge, and prometric spaces}
\label{sec:metric}

Arguably, the goal of general topology is to describe ``spaces'' that are not metrizable but share many attributes of metric spaces.
Thus, it is worth recalling the basic definitions and properties of metric spaces in a constructive context.
We write $\Re$ for the set of extended Dedekind real numbers; these are pairs $(L,U)$ of sets of rational numbers such that:
\begin{enumerate}
\item if $x\in L$ and $y\in U$ then $x<y$,
\item $x\in L$ if and only if there is a $y\in L$ with $x<y$ (roundedness),
\item $y\in U$ if and only if there is an $x\in U$ with $x<y$ (roundedness), and
\item if $x<y$ then either $x\in L$ or $y\in U$ (locatedness).
\end{enumerate}
If we also required $L$ and $U$ to be inhabited, we would get the set $\R$ of ordinary Dedekind real numbers.
In classical mathematics, $\Re$ differs from $\R$ only by including $+\infty = (\mathbb{Q},\emptyset)$ and $-\infty = (\emptyset,\mathbb{Q})$.
Constructively, we can say that $\R = \setof{ x\in \Re | -\infty < x < \infty }$.
We also write
\[\Rp = \setof{x\in\Re | x\ge 0 }.\]

\begin{defn}
  An \textbf{extended quasi-pseudo-metric space} is a set $X$ together with a function $d:X\times X \to \Rp$ such that
  \begin{enumerate}
  \item $d(x,x)=0$ for all $x\in X$ (reflexivity), and
  \item $d(x,z)\le d(x,y)+d(y,z)$ for all $x,y,z\in X$ (transitivity, or the triangle inequality).
  \end{enumerate}
  A \textbf{quasi-pseudo-metric space} is an extended quasi-pseudo-metric space such that
  \begin{enumerate}[resume]
  \item $d(x,y)<\infty$ for all $x,y\in X$ (finite distances).
  \end{enumerate}
  A \textbf{pseudo-metric space} is a quasi-pseudo-metric space such that
  \begin{enumerate}[resume]
  \item $d(x,y)=d(y,x)$ for all $x,y\in X$ (symmetry).
  \end{enumerate}
  A \textbf{metric space} is a pseudo-metric space such that
  \begin{enumerate}[resume]
  \item if $d(x,y)=0$ then $x=y$ (separation).
  \end{enumerate}
\end{defn}

Most of the above terminology is so well-established that we have not attempted to depart from it, but despite their derogatory-sounding name it is really the extended quasi-pseudo-metric spaces that are the fundamental notion.
The additional requirements imposed on a pseudo-metric or metric space are really \emph{separation axioms}, and experience in general topology has shown that a better category is obtained by only imposing separation axioms when necessary rather than including them in definitions.
And allowing infinite distances is arguably of little import topologically.
Moreover, Lawvere~\cite{lawvere:metric-spaces} exhibited extended quasi-pseudo-metric spaces as categories enriched over $(\Rp,\ge,+)$, placing them in a wider context.

In fact, most topological constructions on metric spaces can easily be generalized to the following structures.

\begin{defn}
  An \textbf{(extended) (quasi-)gauge space} is a set $X$ equipped with a set (called a \textbf{gauge}) whose elements are (extended) (quasi-)pseudo-metrics on $X$ (called \textbf{gauging distances}) such that:
  \begin{enumerate}
  \item there exists some gauging distance (nullary filtration), and
  \item if $d_1$ and $d_2$ are gauging distances, there is a gauging distance $d_3$ such that $d_1(x,y)\le d_3(x,y)$ and $d_2(x,y)\le d_3(x,y)$ for all $x,y\in X$ (binary filtration).
  \end{enumerate}
  A gauge space is \textbf{separated} if
  \begin{enumerate}[resume]
  \item for any $x,y\in X$, if $d(x,y)=0$ for all gauging distances $d$, then $x=y$.
  \end{enumerate}
\end{defn}

In other words, a gauge is a filterbase in the poset of (extended quasi-)pseudo-metrics.
Note that the qualifiers ``extended'' and ``quasi-'' carry over from the metrics to the gauge, but all the metrics in a gauge space are automatically assumed to be pseudo; separatedness is named as an additional property.

Of course, any (extended quasi-)pseudo-metric space defines an (extended quasi-)gauge space with exactly one gauging distance.
The essential difference between gauge spaces and metric spaces is that gauge spaces need not be ``countable'' in any of the senses that metric spaces must.
For instance, any family of gauge spaces $\setof{X_k}_{k\in K}$ has a product $\prod_k X_k$ with gauging distances of the form $d(x,y) = \max(d_1(\pi_{k_1}(x),\pi_{k_1}(y)),\dots,d_n(\pi_{k_n}(x),\pi_{k_n}(y)))$ where each $d_i$ is a gauging distance on $X_{k_i}$.
An analogous construction for metric spaces only works if $K$ is finite (a slightly subtler one works if it is countable).

Yet more general than gauge spaces are prometric spaces~\cite{cht:one-setting}:

\begin{defn}
  A \textbf{prometric space} is a set $X$ equipped with a set of functions $d:X\times X\to\Rp$, called \textbf{distances}, such that:
  \begin{enumerate}
  \item there exists a distance (nullary filtration),
  \item if $d_1$ and $d_2$ are distances, there is a distance $d_3$ such that $d_1(x,y)\le d_3(x,y)$ and $d_2(x,y)\le d_3(x,y)$ for all $x,y\in X$ (binary filtration),
  \item $d(x,x)=0$ for every distance and all $x\in X$ (reflexivity),
  \item for any distance $d_1$ there is a distance $d_2$ such that $d_1(x,z)\le d_2(x,y)+d_2(y,z)$ for all $x,y,z\in X$ (transitivity, or the triangle inequality).
  \end{enumerate}
  A prometric space is \textbf{symmetric} if
  \begin{enumerate}[resume]
  \item for any distance $d_1$ there is a distance $d_2$ such that $d_1(x,y)\le d_2(y,x)$ for all $x,y\in X$ (symmetry).
  \end{enumerate}
  It is \textbf{separated} if
  \begin{enumerate}[resume]
  \item for any $x,y\in X$, if $d(x,y)=0$ for all distances $d$, then $x=y$.
  \end{enumerate}
\end{defn}

Since the terminology for prometric spaces is not well-established, we follow~\cite{cht:one-setting} in taking the ``extended quasi'' case to be the default, with symmetry stated explicitly whenever assumed.
Obviously any extended quasi-gauge is also a prometric.
We do not know any important examples of the extra generality afforded by prometric spaces, but they seem a natural level of generality; everything we have to say about metric spaces or gauge spaces in this paper applies just as well to prometric ones.

On the other hand, in constructive mathematics a very different (and much more general) notion is obtained by allowing distances to take values in the (nonnegative extended) \emph{upper} real numbers (sets $U$ of rational numbers satisfying the single axiom ``$y\in U$ if and only if there is an $x\in U$ with $x<y$'', plus $0\notin U$ for nonnegativity).
In this case we will speak of an \textbf{upper prometric space}.
%If necessary, we distinguish ordinary real numbers from upper ones by calling them \textbf{located}, and ordinary prometric spaces from upper ones by calling them \textbf{decomposable}.

The main difference is that unlike located real numbers, upper real numbers constructively admit arbitrary infima.
Thus, for instance, any set $X$ admits a \emph{discrete} upper prometric with one distance defined by $d(x,y) = \inf \setof{ t | t=0 \land x=y }$, so that $d(x,x)=0$ but $d(x,y)=+\infty$ if $x\neq y$.
This distance takes real values if and only if $X$ has decidable equality, since if $d(x,y)$ were real then it would be either $<2$ (in which case $x=y$) or $>1$ (in which case $x\neq y$).
As we will see, locatedness of distances is crucial for the special behavior of (pro)metric spaces among arbitrary spaces in constructive mathematics.
We will return to upper prometric spaces briefly in \cref{sec:uniformity}.

We now review some of the fundamental concepts from metric spaces that one intends to capture for more general spaces, simultaneously generalizing them to prometric ones.
In the following, $X$ and $Y$ denote prometric spaces; $\ep$ and $\de$ are assumed to range over $\Rp$; and $d_X$ and $d_Y$ are assumed to range over distances on $X$ and $Y$ respectively.
We begin with continuity of functions.

\begin{itemize}
\item A function $f:X\to Y$ is \textbf{continuous} if for all $x\in X$, $d_Y$, and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $y\in X$, if $d_X(x,y)<\de$ then $d_Y(f(x),f(y))<\ep$.
\item Similarly, $f:X\to Y$ is \textbf{uniformly continuous} if for all $d_Y$ and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $x,y\in X$, if $d_X(x,y)<\de$ then $d_Y(f(x),f(y))<\ep$.
% \item We will say $f:X\to Y$ is \textbf{cocontinuous}\fxwarning{Does this have a standard name?} if for all $x\in X$, $d_Y$, and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $y\in X$, if $d_Y(f(x),f(y))>\ep$ then $d_X(x,y)>\de$.
% \item Similarly, $f:X\to Y$ is \textbf{uniformly cocontinuous} if for all $d_Y$ and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $x,y\in X$, if $d_Y(f(x),f(y))>\ep$ then $d_X(x,y)>\de$.
\end{itemize}

The locatedness of distances enables us to characterize continuity in a converse fashion:

\begin{lem}\label{thm:cocontinuous}
  For prometric spaces $X$ and $Y$, a function $f:X\to Y$ is continuous if and only if for all $x\in X$, $d_Y$, and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $y\in X$, if $d_Y(f(x),f(y))>\ep$ then $d_X(x,y)>\de$.
\end{lem}
\begin{proof}
  If $f$ is continuous, then given $d_Y$ and $\ep$, let $d_X$ and $\de$ be as in the definition of continuity.
  Then if $d_Y(f(x),f(y)) > \ep$, we cannot have $d_X(x,y) < \de$, so we must have $d_X(x,y) > \frac{\de}{2}$.

  Conversely, if the stated condition holds, then given $d_Y$ and $\ep$, let $d_X$ and $\de$ be such that $d_Y(f(x),f(y))>\frac{\ep}{2} \Rightarrow d_X(x,y)>\de$.
  Then if $d_X(x,y)<\de$, we cannot have $d_Y(f(x),f(y))>\frac{\ep}{2}$, so we must have $d_Y(f(x),f(y))<\ep$.
\end{proof}

Similarly we have:

\begin{lem}\label{thm:unif-cocontinuous}
  For prometric spaces $X$ and $Y$, a function $f:X\to Y$ is uniformly continuous if and only if for all $d_Y$ and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $x,y\in X$, if $d_Y(f(x),f(y))>\ep$ then $d_X(x,y)>\de$.\qed
\end{lem}

We continue with notions of convergence and completeness.

\begin{itemize}
\item $X$ is \textbf{totally bounded} if for all $d_X$ and $\ep>0$ there is a finite set $F\subseteq X$ such that for all $y\in X$ there is an $x\in F$ such that $d_X(x,y)<\ep$.
\item A sequence $\setof{x_n}$ in $X$ \textbf{converges} to $x\in X$ if for every $d_X$ and $\ep>0$ there is an $N$ such that for any $n$, if $n>N$ then $d_X(x,x_n)<\ep$.
\item More generally, a filter $\F$ in $X$ \textbf{converges} to $x\in X$ if for every $d_X$ and $\ep>0$ there is an $A\in\F$ such that for all $y\in A$ we have $d_X(x,y)<\ep$.
\item A sequence $\setof{x_n}$ in $X$ is \textbf{Cauchy} if for every $d_X$ and $\ep>0$ there is an $N$ such that for any $n,m$, if $n,m>N$ then $d_X(x_n,x_m)<\ep$.
\item A filter $\F$ in $X$ is \textbf{Cauchy} if for every $d_X$ and $\ep>0$ there is an $A\in\F$ such that for all $x,y\in A$ we have $d_X(x,y)<\ep$.
\item $X$ is \textbf{complete} if every Cauchy filter converges to some point.
\end{itemize}

For metric spaces, it suffices to consider convergent and Cauchy \emph{sequences}, but in the gauge and prometric cases we must deal with filters (or nets).
Note that the above definitions of Cauchy filter and complete space are only really sensible in the symmetric case; we will return to this later.\fxnote{Do that}

In classical mathematics, a metric space is \emph{compact} if and only if it is complete and totally bounded.
Constructively, this is not so; thus one generally either uses ``complete and totally bounded'' as a replacement for ``compact'', or passes to locales instead of spaces (see \cref{sec:locales}).

% Classically, one can \emph{complete} a metric space by equipping a set of equivalence classes of Cauchy sequences with a metric.

We now embark on a process of generalization whose goal is to remove the ``non-topological'' information contained in a prometric, and express the result in an intrinsic way.
In particular, prometric spaces that are topologically isomorphic (by continuous functions), or in some cases uniformly isomorphic (by uniformly continuous functions), ought to give rise to ``topological'' structures that are actually indistinguishable.
In general the way we do this is by considering \emph{relations} between points or subsets rather than distances between them.


\section{Point-point relations: order and apartness}
\label{sec:point-point}
\label{sec:order}

There are two important relations between points in a prometric space.
As always, $d_X$ will range over distances in a prometric space $X$.

\begin{defn}
  Let $x,y\in X$ be points of a prometric space.
  \begin{itemize}
  \item We say $x\le y$ if $\forall d_X, d_X(y,x)=0$.\fxwarning{ordering convention?}
  \item We say $x<y$ if $\exists d_X, d_X(x,y)>0$.
  \end{itemize}
\end{defn}

\begin{thm}
  For any prometric space $X$, the relation $\le$ is a preorder.
  If $X$ is symmetric, then $\le$ is a symmetric relation, and hence an \textbf{equivalence relation} (which we will usually write as $\approx$).
\end{thm}
\begin{proof}
  Reflexivity and transitivity of $\le$ follow from reflexivity and transitivity (i.e.\ the triangle inequality) of a prometric, and likewise for symmetry.
\end{proof}

As we will see later, $\le$ is an instance of the \emph{specialization order} underlying a topology.

\begin{thm}
  For any prometric space $X$, the relation $<$ is an \emph{irreflexive comparison}, i.e.\ it satisfies:
  \begin{enumerate}
  \item $\neg(x<x)$ for all $x$ (irreflexivity), and
  \item if $x<z$ then for any $y$ we have $x<y$ or $y<z$ (comparison).
  \end{enumerate}
  If $X$ is symmetric, then $<$ is also a symmetric relation, and hence an \textbf{apartness relation} (usually written $\apart$).
\end{thm}
\begin{proof}
  Irreflexivity of $<$ follows directly from reflexivity of a prometric.
  Comparison is rather trickier: if $d(x,z)>0$, we have another distance $d'$ with $d'(x,y)+d'(y,z)\ge d(x,z)$.
  By locatedness of real numbers, $d'(x,y)$ and $d'(y,z)$ are both either $>0$ or $<\frac12 d(x,z)$.
  Thus either $x<y$ or $y<z$ or $d'(x,y)+d'(y,z) < d(x,z)$; but the latter case is a contradiction.
\end{proof}

The notation $x<y$ is somewhat misleading; in particular this relation is rarely transitive.
By analogy with the previous and following sections, we might also call a comparison a 
\textbf{decomposable} relation.

For located real numbers, $\neg(a<b)$ is equivalent to $b\le a$.
%(For upper real numbers, we define $U_1 < U_2$ if $U_1\setminus U_2$ is inhabited, and $U_2\le U_1$ if $U_1 \subseteq U_2$; neither of these is the negation of the other.)
Thus $x\approx y$ in a prometric space is equivalent to $\neg(x\apart y)$.
However, $\apart$ cannot constructively be expressed in terms of $\approx$; to say $x\apart y$ is stronger than $x\neq y$.

If $X$ is separated, then $x\approx y$ (and even $x\le y$, in the non-symmetric case) implies $x=y$.
An apartness relation such that $\neg(x\apart y)$ implies $x=y$ is called \textbf{tight}.
In particular, the equality relation of a separated prometric space is $\neg\neg$-stable, for $\neg\neg(x=y)$ implies $\neg(x\apart y)$, hence $x\approx y$ and thus $x=y$.

Finally, we observe that the point-point relations underlying a prometric space vary appropriately with continuous functions, so that they really are a topological invariant.

\begin{thm}
  Let $X$ and $Y$ be prometric spaces and $f:X\to Y$ a continuous function.
  Then:
  \begin{enumerate}
  \item $f$ is a \textbf{monotone map} of preorders, i.e.\ if $x\le y$ then $f(x)\le f(y)$.
  \item $f$ is a \textbf{strongly extensional} map of comparisons, i.e.\ if $f(x)<f(y)$ then $x<y$.
  \end{enumerate}
\end{thm}
\begin{proof}
  For the first, given any $d_Y$ and $\ep>0$ we have a $d_X$ and $\de>0$ such that $d_X(x,y)<\de$ implies $d_Y(f(x),f(y))<\ep$.
  But $d_X(x,y)<\de$ is always true if $x\le y$; hence so is $d_Y(f(x),f(y))<\ep$, and thus $f(x)\le f(y)$.

  For the second, if $f(x)<f(y)$ we have $d_Y(f(x),f(y))>0$ for some $d_Y$.
  Let $\ep = \frac12 \,d_Y(f(x),f(y))$; then by \cref{thm:cocontinuous} we have a $d_X$ and a $\de>0$ such that if $d_Y(f(x),f(y))>\ep$ (which is true) then $d_X(x,y)>\de$, hence $x<y$.
\end{proof}


\section{Point-set relations: topology}
\label{sec:point-set}
\label{sec:topology}

The specialization order and the apartness relation, while important, do not generally capture very much of the topological information in a prometric space.
The crucial step that brings us into the world of general topology is to consider relations involving \emph{sets} as well as points.
There are three fundamental relations between a point and a set that can be defined in a prometric space $X$ (with $d_X$ ranging over distances and $\ep$ over positive reals, as always):

\begin{defn}
  Let $x\in X$ and $A\subseteq X$.
  \begin{enumerate}
  \item We say $x\approx A$ if $\forall d_X, \forall \ep, \exists y, (y\in A \land d_X(x,y)<\ep)$.
  \item We say $x\bowtie A$ if $\exists d_X, \exists \ep, \forall y, (y\in A \Rightarrow d_X(x,y)>\ep)$.
  \item We say $x\ll A$ if $\exists d_X, \exists \ep, \forall y, (d_X(x,y)<\ep \Rightarrow y\in A)$.
  \end{enumerate}
\end{defn}


  % Define these when we introduce their abstract versions.
% \item $U\subseteq X$ is a \textbf{neighborhood} of $x\in U$ if there is an $\ep>0$ such that for all $y$, if $d(x,y)<\ep$ then $y\in U$.
% \item $U\subseteq X$ is \textbf{open} if it is a neighborhood of each of its points, i.e.\ for all $x\in U$ there is an $\ep>0$ such that for all $y$, if $d(x,y)<\ep$ then $y\in U$.
% \item $C\subseteq X$ is \textbf{weakly closed} if whenever for all $\ep>0$ there is a $y\in C$ with $d(x,y)<\ep$, then $x\in C$.
%   It is \textbf{strongly closed} if $C=X\setminus U$ for some open set $U$.
% \item The \textbf{weak closure} of $C\subseteq X$ is the set of all $x$ such that for all $\ep>0$ there is a $y\in C$ with $d(x,y)<\ep$.
%   Thus $C$ is weakly closed iff it is equal to its weak closure.
% \item $A\subseteq X$ is \textbf{strongly dense} if for any $x\in X$ and $\ep>0$, there is an $a\in A$ with $d(x,a)<\ep$.
%   It is \textbf{weakly dense} if there does not exist an $x$ and an $\ep>0$ such that $d(x,y)<\ep$ implies $y\notin A$.


\section{Filters of point-point relations: uniformity}
\label{sec:uniformity}


TODO: Upper prometric spaces are equivalent to uniform spaces; lower prometric spaces are equivalent to uniform apartness spaces.


\section{Approach spaces and filters of point-set relations}
\label{sec:approach}



\section{Set-set relations: proximity}
\label{sec:set-set}
\label{sec:proximity}



\section{Filters of set-set relations: syntopogeny}
\label{sec:syntop}



\section{Located subspaces}
\label{sec:located}

\begin{defn}
  A subset $A\subseteq X$ is \textbf{(metrically) located} if for all $x\in X$, the set $\setof{ d(x,y) | y\in A }$ has an greatest lower bound, written $d(x,A)$.
  \fxwarning{Which direction does this go in the quasi case?}
\end{defn}

Classically, the poset $\Rp$ is a complete lattice, and thus every subset is located.
(Even the empty set: $d(x,\emptyset)=\infty$.
This is one good reason for allowing infinite distances.)
However, constructively there are ``wild'' subsets such as $\setof{x\in X | P}$, for some undecidable proposition $P$, that cannot be shown to be located in general.
\fxnote{Mention some theorems about located subsets.}

Note: approach spaces have a distance between points and sets, definable from a metric space by infima.
Constructively this produces only an upper-real-valued distance, unless all subsets are located.
Presumably there are ``pro-approach spaces'' that arise from prometric spaces, or at least from gauge spaces.
Upper pro-approach spaces also give rise to syntopogenous spaces, but not decomposable ones.


\bibliographystyle{alpha}
\bibliography{syntop}

\end{document}
