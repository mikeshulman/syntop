\documentclass{article}
\input{decls}
\usepackage[status=draft]{fixme}
\title{Unifying constructive general topology}
\author{Toby Bartels and Michael Shulman}
\def\R{\mathbb{R}}
\def\Re{\overline{\mathbb{R}}}
\def\Rp{[0,\infty]}
%\def\Rpf{[0,\infty)}
\def\F{\mathcal{F}}
\def\apart{\mathrel{\#}}
\def\napprox{\not\approx}
\def\nle{\not\le}
\def\oapt{\mathrel{\!\not\,\not\lesssim}}
\def\leapx{\lesssim}
\def\int{\mathrm{int}}
\def\ext{\mathrm{ext}}
\def\cl{\mathrm{cl}}
\def\cpl#1{\neg #1}
\let\implies\Rightarrow
\def\inv{^{-1}}
\def\hfep{\frac{\ep}{2}}
\def\singleton#1{\{#1\}}
\begin{document}
\maketitle

\section{Introduction}
\label{sec:intro}

\section{Metric, gauge, and prometric spaces}
\label{sec:metric}

Arguably, the goal of general topology is to describe ``spaces'' that are not metrizable but share many attributes of metric spaces.
Thus, it is worth recalling the basic definitions and properties of metric spaces in a constructive context.
We write $\Re$ for the set of extended Dedekind real numbers; these are pairs $(L,U)$ of sets of rational numbers such that:
\begin{enumerate}
\item if $x\in L$ and $y\in U$ then $x<y$,
\item $x\in L$ if and only if there is a $y\in L$ with $x<y$ (roundedness),
\item $y\in U$ if and only if there is an $x\in U$ with $x<y$ (roundedness), and
\item if $x<y$ then either $x\in L$ or $y\in U$ (locatedness).
\end{enumerate}
If we also required $L$ and $U$ to be inhabited, we would get the set $\R$ of ordinary Dedekind real numbers.
In classical mathematics, $\Re$ differs from $\R$ only by including $+\infty = (\mathbb{Q},\emptyset)$ and $-\infty = (\emptyset,\mathbb{Q})$.
Constructively, we can say that $\R = \setof{ x\in \Re | -\infty < x < \infty }$.
We also write
\[\Rp = \setof{x\in\Re | x\ge 0 }.\]
We remind the reader that constructively, the real numbers admit both a strict order $<$ and a non-strict order $\le$, where $x\le y$ is equivalent to $\neg(y<x)$, but $x<y$ is stronger than $\neg(y\le x)$, and $x\le y$ is weaker than $(x=y)\lor (x<y)$.

\begin{defn}
  An \textbf{extended quasi-pseudo-metric space} is a set $X$ together with a function $d:X\times X \to \Rp$ such that
  \begin{enumerate}
  \item $d(x,x)=0$ for all $x\in X$ (reflexivity), and
  \item $d(x,z)\le d(x,y)+d(y,z)$ for all $x,y,z\in X$ (transitivity, or the triangle inequality).
  \end{enumerate}
  A \textbf{quasi-pseudo-metric space} is an extended quasi-pseudo-metric space such that
  \begin{enumerate}[resume]
  \item $d(x,y)<\infty$ for all $x,y\in X$ (finite distances).
  \end{enumerate}
  A \textbf{pseudo-metric space} is a quasi-pseudo-metric space such that
  \begin{enumerate}[resume]
  \item $d(x,y)=d(y,x)$ for all $x,y\in X$ (symmetry).
  \end{enumerate}
  A \textbf{metric space} is a pseudo-metric space such that
  \begin{enumerate}[resume]
  \item if $d(x,y)=0$ then $x=y$ (separation).
  \end{enumerate}
\end{defn}

Most of the above terminology is so well-established that we have not attempted to depart from it, but despite their derogatory-sounding name it is really the extended quasi-pseudo-metric spaces that are the fundamental notion.
The additional requirements imposed on a pseudo-metric or metric space are really \emph{separation axioms}, and experience in general topology has shown that a better category is obtained by only imposing separation axioms when necessary rather than including them in definitions.
And allowing infinite distances is arguably of little import topologically.
Moreover, Lawvere~\cite{lawvere:metric-spaces} exhibited extended quasi-pseudo-metric spaces as categories enriched over $(\Rp,\ge,+)$, placing them in a wider context.

In fact, most topological constructions on metric spaces can easily be generalized to the following structures.

\begin{defn}
  An \textbf{(extended) (quasi-)gauge space} is a set $X$ equipped with a set (called a \textbf{gauge}) whose elements are (extended) (quasi-)pseudo-metrics on $X$ (called \textbf{gauging distances}) such that:
  \begin{enumerate}
  \item there exists some gauging distance (nullary filtration), and
  \item if $d_1$ and $d_2$ are gauging distances, there is a gauging distance $d_3$ such that $d_1(x,y)\le d_3(x,y)$ and $d_2(x,y)\le d_3(x,y)$ for all $x,y\in X$ (binary filtration).
  \end{enumerate}
  A gauge space is \textbf{separated} if
  \begin{enumerate}[resume]
  \item for any $x,y\in X$, if $d(x,y)=0$ for all gauging distances $d$, then $x=y$.
  \end{enumerate}
\end{defn}

In other words, a gauge is a filterbase in the poset of (extended quasi-)pseudo-metrics.
Note that the qualifiers ``extended'' and ``quasi-'' carry over from the metrics to the gauge, but all the metrics in a gauge space are automatically assumed to be pseudo; separatedness is named as an additional property.

Of course, any (extended quasi-)pseudo-metric space defines an (extended quasi-)gauge space with exactly one gauging distance.
The essential difference between gauge spaces and metric spaces is that gauge spaces need not be ``countable'' in any of the senses that metric spaces must.
For instance, any family of gauge spaces $\setof{X_k}_{k\in K}$ has a product $\prod_k X_k$ with gauging distances of the form $d(x,y) = \max(d_1(\pi_{k_1}(x),\pi_{k_1}(y)),\dots,d_n(\pi_{k_n}(x),\pi_{k_n}(y)))$ where each $d_i$ is a gauging distance on $X_{k_i}$.
An analogous construction for metric spaces only works if $K$ is finite (a slightly subtler one works if it is countable).

Yet more general than gauge spaces are prometric spaces~\cite{cht:one-setting}:

\begin{defn}
  A \textbf{prometric space} is a set $X$ equipped with a set of functions $d:X\times X\to\Rp$, called \textbf{distances}, such that:
  \begin{enumerate}
  \item there exists a distance (nullary filtration),
  \item if $d_1$ and $d_2$ are distances, there is a distance $d_3$ such that $d_1(x,y)\le d_3(x,y)$ and $d_2(x,y)\le d_3(x,y)$ for all $x,y\in X$ (binary filtration),
  \item $d(x,x)=0$ for every distance and all $x\in X$ (reflexivity),
  \item for any distance $d_1$ there is a distance $d_2$ such that $d_1(x,z)\le d_2(x,y)+d_2(y,z)$ for all $x,y,z\in X$ (transitivity, or the triangle inequality).
  \end{enumerate}
  A prometric space is \textbf{symmetric} if
  \begin{enumerate}[resume]
  \item for any distance $d_1$ there is a distance $d_2$ such that $d_1(x,y)\le d_2(y,x)$ for all $x,y\in X$ (symmetry).
  \end{enumerate}
  It is \textbf{separated} if
  \begin{enumerate}[resume]
  \item for any $x,y\in X$, if $d(x,y)=0$ for all distances $d$, then $x=y$.
  \end{enumerate}
\end{defn}

Since the terminology for prometric spaces is not well-established, we follow~\cite{cht:one-setting} in taking the ``extended quasi'' case to be the default, with symmetry stated explicitly whenever assumed.
Obviously any extended quasi-gauge is also a prometric.
We do not know any important examples of the extra generality afforded by prometric spaces, but they seem a natural level of generality; everything we have to say about metric spaces or gauge spaces in this paper applies just as well to prometric ones.

On the other hand, in constructive mathematics a very different (and much more general) notion is obtained by allowing distances to take values in the (nonnegative extended) \emph{upper} real numbers (sets $U$ of rational numbers satisfying the single axiom ``$y\in U$ if and only if there is an $x\in U$ with $x<y$'', plus $0\notin U$ for nonnegativity).
In this case we will speak of an \textbf{upper prometric space}.
%If necessary, we distinguish ordinary real numbers from upper ones by calling them \textbf{located}, and ordinary prometric spaces from upper ones by calling them \textbf{decomposable}.

The main difference is that unlike located real numbers, upper real numbers constructively admit arbitrary infima.
Thus, for instance, any set $X$ admits a \emph{discrete} upper prometric with one distance defined by $d(x,y) = \inf \setof{ t | t=0 \land x=y }$, so that $d(x,x)=0$ but $d(x,y)=+\infty$ if $x\neq y$.
This distance takes real values if and only if $X$ has decidable equality, since if $d(x,y)$ were real then it would be either $<2$ (in which case $x=y$) or $>1$ (in which case $x\neq y$).
As we will see, locatedness of distances is crucial for the special behavior of (pro)metric spaces among arbitrary spaces in constructive mathematics.
We will return to upper prometric spaces briefly in \cref{sec:uniformity}.

A metric space, and even a prometric space, contains a lot of information.
Some of that information is \emph{numerical}, since points are compared by real number distances.
However, for some purposes we are only interested in ``topological'' or ``geometric'' features that are, for instance, invariant with respect to scaling of distances.
Category-theoretically, this means we consider (pro)metric spaces as the objects of various different categories.
The two primary types of morphism we will be interested in are the following.
(Here $X$ and $Y$ denote prometric spaces; $\ep$ and $\de$ are assumed to range over $\Rp$; and $d_X$ and $d_Y$ are assumed to range over distances on $X$ and $Y$ respectively.)

\begin{itemize}
\item A function $f:X\to Y$ is \textbf{continuous} if for all $x\in X$, $d_Y$, and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $y\in X$, if $d_X(x,y)<\de$ then $d_Y(f(x),f(y))<\ep$.
\item Similarly, $f:X\to Y$ is \textbf{uniformly continuous} if for all $d_Y$ and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $x,y\in X$, if $d_X(x,y)<\de$ then $d_Y(f(x),f(y))<\ep$.
% \item We will say $f:X\to Y$ is \textbf{cocontinuous}\fxwarning{Does this have a standard name?} if for all $x\in X$, $d_Y$, and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $y\in X$, if $d_Y(f(x),f(y))>\ep$ then $d_X(x,y)>\de$.
% \item Similarly, $f:X\to Y$ is \textbf{uniformly cocontinuous} if for all $d_Y$ and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $x,y\in X$, if $d_Y(f(x),f(y))>\ep$ then $d_X(x,y)>\de$.
\end{itemize}

The locatedness of distances enables us to characterize continuity in a converse fashion:

\begin{lem}\label{thm:cocontinuous}
  For prometric spaces $X$ and $Y$, a function $f:X\to Y$ is continuous if and only if for all $x\in X$, $d_Y$, and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $y\in X$, if $d_Y(f(x),f(y))>\ep$ then $d_X(x,y)>\de$.
\end{lem}
\begin{proof}
  If $f$ is continuous, then given $d_Y$ and $\ep$, let $d_X$ and $\de$ be as in the definition of continuity.
  Then if $d_Y(f(x),f(y)) > \ep$, we cannot have $d_X(x,y) < \de$, so we must have $d_X(x,y) > \frac{\de}{2}$.

  Conversely, if the stated condition holds, then given $d_Y$ and $\ep$, let $d_X$ and $\de$ be such that $d_Y(f(x),f(y))>\hfep \implies d_X(x,y)>\de$.
  Then if $d_X(x,y)<\de$, we cannot have $d_Y(f(x),f(y))>\hfep$, so we must have $d_Y(f(x),f(y))<\ep$.
\end{proof}

\begin{lem}\label{thm:unif-cocontinuous}
  For prometric spaces $X$ and $Y$, a function $f:X\to Y$ is uniformly continuous if and only if for all $d_Y$ and $\ep>0$ there are $d_X$ and $\de>0$ such that for all $x,y\in X$, if $d_Y(f(x),f(y))>\ep$ then $d_X(x,y)>\de$.\qed
\end{lem}

Among the notions that are invariants of continuity or uniform continuity are convergence and completeness.
When there is only one prometric space $X$, we assume that the letter $d$ ranges over distances on $X$.

\begin{itemize}
\item $X$ is \textbf{totally bounded} if for all $d$ and $\ep>0$ there is a finite set $F\subseteq X$ such that for all $y\in X$ there is an $x\in F$ such that $d(x,y)<\ep$.
\item A sequence $\setof{x_n}$ in $X$ \textbf{converges} to $x\in X$ if for every $d$ and $\ep>0$ there is an $N$ such that for any $n$, if $n>N$ then $d(x,x_n)<\ep$.
\item More generally, a filter $\F$ in $X$ \textbf{converges} to $x\in X$ if for every $d$ and $\ep>0$ there is an $A\in\F$ such that for all $y\in A$ we have $d(x,y)<\ep$.
\item A sequence $\setof{x_n}$ in $X$ is \textbf{Cauchy} if for every $d$ and $\ep>0$ there is an $N$ such that for any $n,m$, if $n,m>N$ then $d(x_n,x_m)<\ep$.
\item A filter $\F$ in $X$ is \textbf{Cauchy} if for every $d$ and $\ep>0$ there is an $A\in\F$ such that for all $x,y\in A$ we have $d(x,y)<\ep$.
\item $X$ is \textbf{complete} if every Cauchy filter converges to some point.
\end{itemize}

For metric spaces, it suffices to consider convergent and Cauchy \emph{sequences}, but in the gauge and prometric cases we must deal with filters (or nets).
Note that the above definitions of Cauchy filter and complete space are only really sensible in the symmetric case; we will return to this later.\fxnote{Do that}

In classical mathematics, a metric space is \emph{compact} if and only if it is complete and totally bounded.
Constructively, this is not so; thus one generally either uses ``complete and totally bounded'' as a replacement for ``compact'', or passes to locales instead of spaces (see \cref{sec:locales}).

% Classically, one can \emph{complete} a metric space by equipping a set of equivalence classes of Cauchy sequences with a metric.

We now embark on a process of generalization whose goal is to remove the ``non-topological'' information contained in a prometric, and express the result in an intrinsic way.
In particular, prometric spaces that are topologically isomorphic (by continuous functions), or in some cases uniformly isomorphic (by uniformly continuous functions), ought to give rise to ``topological'' structures that are actually indistinguishable.
In general the way we do this is by considering \emph{relations} between points or subsets rather than distances between them.


\section{Point-point relations: order and apartness}
\label{sec:point-point}
\label{sec:order}

There are two important relations between points in a prometric space.
As always, $d$ will range over distances in a prometric space $X$.

\begin{defn}\label{def:promet-ord}
  Let $x,y\in X$ be points of a prometric space.
  \begin{itemize}
  \item We say $x\leapx y$ if $\forall d, d(x,y)=0$.\fxwarning{ordering convention?}
  \item We say $x\oapt y$ if $\exists d, d(x,y)>0$.
  \end{itemize}
\end{defn}

\begin{thm}
  For any prometric space $X$, the relation $\leapx$ is a preorder.
  If $X$ is symmetric, then $\leapx$ is a symmetric relation, and hence an \textbf{equivalence relation} (which we will usually write as $\approx$).
\end{thm}
\begin{proof}
  Reflexivity and transitivity of $\leapx$ follow from reflexivity and transitivity (i.e.\ the triangle inequality) of a prometric, and likewise for symmetry.
\end{proof}

As we will see later, $\leapx$ is an instance of the \emph{specialization order} underlying a topology.

\begin{thm}
  For any prometric space $X$, the relation $\oapt$ is an \emph{irreflexive comparison}, i.e.\ it satisfies:
  \begin{enumerate}
  \item $\neg(x\oapt x)$ for all $x$ (irreflexivity), and
  \item if $x\oapt z$ then for any $y$ we have $x\oapt y$ or $y\oapt z$ (comparison).
  \end{enumerate}
  If $X$ is symmetric, then $\oapt $ is also a symmetric relation, and hence an \textbf{apartness relation} (usually written $\apart$).
\end{thm}
\begin{proof}
  Irreflexivity of $\oapt $ follows directly from reflexivity of a prometric.
  Comparison is rather trickier: if $d(x,z)>0$, we have another distance $d'$ with $d'(x,y)+d'(y,z)\ge d(x,z)$.
  By locatedness of real numbers, $d'(x,y)$ and $d'(y,z)$ are both either $>0$ or $<\frac12 d(x,z)$.
  Thus either $x\oapt y$ or $y\oapt z$ or $d'(x,y)+d'(y,z) < d(x,z)$; but the latter case is a contradiction.
\end{proof}

By analogy with later sections, we might also call a comparison a \textbf{locally decomposable} relation.

Since $\neg(a<b)$ is equivalent to $b\le a$ for located real numbers, in a prometric space we have
\[ (x\leapx y) \iff \neg(x\oapt y). \]
However, $\oapt$ cannot constructively be expressed in terms of $\leapx$; to say $x\oapt y$ is stronger than $x\neq y$ or even $x\not\leapx y$.

\begin{warn}
  Some constructive mathematicians write $\neq$ for an arbitrary apartness relation.
  We will always reserve slashed symbols such as $\neq,\not\leapx,\napprox,\notin$ for logical negations (i.e.\ $x\neq y$ means $\neg(x=y)$, $x\not\leapx y$ means $\neg(x\leapx y)$, etc.), and use other symbols such as $\apart$ and $\oapt$ for stronger ``positive'' relations.
\end{warn}

If $X$ is separated, then $x\leapx y$ (and hence equivalently $\neg(x\oapt y)$) implies $x=y$.
A relation $\oapt$ (such as an apartness relation) with the property that $\neg(x\oapt y)$ implies $x=y$ is sometimes called \textbf{tight} or \textbf{connected}.
In particular, the equality relation of a separated prometric space is $\neg\neg$-stable, for $\neg\neg(x=y)$ implies $\neg(x\oapt y)$, hence $x\leapx y$ and thus $x=y$.

Finally, we observe that the point-point relations underlying a prometric space vary appropriately with continuous functions, so that they really are a topological invariant.

\begin{thm}
  Let $X$ and $Y$ be prometric spaces and $f:X\to Y$ a continuous function.
  Then:
  \begin{enumerate}
  \item $f$ is a \textbf{monotone map} of preorders, i.e.\ if $x\leapx y$ then $f(x)\leapx f(y)$.
  \item $f$ is a \textbf{strongly extensional} map of comparisons, i.e.\ if $f(x)\oapt f(y)$ then $x\oapt y$.
  \end{enumerate}
\end{thm}
\begin{proof}
  For the first, given any $d_Y$ and $\ep>0$ we have a $d_X$ and $\de>0$ such that $d_X(x,y)<\de$ implies $d_Y(f(x),f(y))<\ep$.
  But $d_X(x,y)<\de$ is always true if $x\leapx y$; hence so is $d_Y(f(x),f(y))<\ep$, and thus $f(x)\leapx f(y)$.

  For the second, if $f(x)\oapt f(y)$ we have $d_Y(f(x),f(y))>0$ for some $d_Y$.
  Let $\ep = \frac12 \,d_Y(f(x),f(y))$; then by \cref{thm:cocontinuous} we have a $d_X$ and a $\de>0$ such that if $d_Y(f(x),f(y))>\ep$ (which is true) then $d_X(x,y)>\de$, hence $x\oapt y$.
\end{proof}


\section{Point-set relations: topology}
\label{sec:point-set}
\label{sec:topology}

The specialization order and the apartness relation, while important, do not usually capture very much of the topological information in a prometric space.
The crucial step that brings us into the world of general topology is to consider relations involving \emph{sets} as well as points.
There are three fundamental relations between a point and a set that can be defined in a prometric space $X$ (with $d$ ranging over distances and $\ep$ over positive reals, as always):

\begin{defn}\label{defn:toprels}
  Let $x\in X$ and $A\subseteq X$.
  \begin{enumerate}
  \item $x\ll A$ if $\exists d, \exists \ep, \forall y, (d(x,y)<\ep \implies y\in A)$ ($A$ is a \textbf{neighborhood} of $x$).
  \item $x\bowtie A$ if $\exists d, \exists \ep, \forall y, (y\in A \implies d(x,y)>\ep)$ ($x$ is \textbf{apart} from $A$).
  \item $x\approx A$ if $\forall d, \forall \ep, \exists y, (y\in A \land d(x,y)<\ep)$ ($x$ is \textbf{close} to $A$).
  \end{enumerate}
\end{defn}

We can now axiomatize the basic properties of these relations.

\begin{defn}
  A \textbf{topological neighborhood space} (or simply a \textbf{topological space} --- see below) is a set $X$ with a relation $\ll$ between points and subsets such that
  \begin{enumerate}
  \item If $x\ll A$ and $A\subseteq B$, then $x\ll B$ (isotony).
  \item If $x\ll A$, then $x\in A$ (reflexivity).
  \item $x\ll X$ for all $x\in X$ (nullary additivity).
  \item If $x\ll A$ and $x\ll B$, then $x\ll A\cap B$ (binary additivity).
  \item If $x\ll A$, then $x \ll \setof{ y | y\ll A}$ (transitivity).
  \end{enumerate}
  If $X$ and $Y$ are topological neighborhood spaces, a function $f:X\to Y$ is \textbf{continuous} if $f(x)\ll A$ implies $x\ll f\inv(A)$.
\end{defn}

\begin{defn}
  A \textbf{topological apartness space} (or sometimes a \textbf{point-set apartness space}) is a set $X$ with a relation $\bowtie$ between points and subsets such that
  \begin{enumerate}
  \item If $x\bowtie A$ and $B\subseteq A$, then $x\bowtie B$ (isotony).
  \item If $x\bowtie A$, then $x\notin A$ (reflexivity).
  \item $x\bowtie \emptyset$ for all $x\in X$ (nullary additivity).
  \item If $x\bowtie A$ and $x\bowtie B$, then $x\bowtie A\cup B$ (binary additivity).
  \item If $x\bowtie A$, then $x\bowtie \setof{ y | y \not\bowtie A }$ (transitivity).
  \end{enumerate}
  If $X$ and $Y$ are topological apartness space, a function $f:X\to Y$ is \textbf{continuous} if $f(x)\bowtie f(A)$ implies $x\bowtie A$.
\end{defn}

\begin{defn}
  A \textbf{topological closure space} is a set $X$ with a relation $\approx$ between points and subsets such that
  \begin{enumerate}
  \item If $x\approx A$ and $A\subseteq B$, then $x\approx B$ (isotony).
  \item If $x\in A$, then $x\approx A$ (reflexivity).
  \item $x\napprox \emptyset$ for all $x\in X$ (nullary additivity).
  \item If $x\approx A\cup B$, then $x\approx A$ or $x\approx B$ (binary additivity).
  \item If $x\approx \setof{ y | y\approx A}$, then $x\approx A$ (transitivity).
  \end{enumerate}
  If it satisfies all the above axioms except binary additivity, we call it a \textbf{Moore closure space}.
  If $X$ and $Y$ are topological or Moore closure spaces, a function $f:X\to Y$ is \textbf{continuous} if $x\approx A$ implies $f(x) \approx f(A)$.
\end{defn}

A relation between points and subsets can equivalently be defined in terms of an operation taking each subset to the subset of points related to it.
For instance, in a topological neighborhood space, the \textbf{interior} of a set $A$ is
\[ \int(A) = \setof{ x | x\ll A } \]
The axioms of $\ll$ say exactly that $\int$ is a left-exact monad on the powerset of $X$.
Hence it is determined by its fixed points, which are called \textbf{open sets}, and are closed under arbitrary unions and finite intersections.
This is, of course, the usual definition of a topological space.
We will stick to working directly with $\ll$, however, since it generalizes better.

Similarly, in a topological or Moore closure space, the \textbf{closure} of a set $A$ is
\[ \cl(A) = \setof{x | x \approx A } \]
The axioms of $\approx$ say exactly that $\cl$ is a comonad on the powerset of $X$, which is right-exact iff $X$ is topological.
Hence it is determined by its fixed points, which are called \textbf{closed sets}, and are closed under arbitrary intersections (and finite unions, if $X$ is topological).

Finally, in a topological apartness space, the \textbf{exterior} of a set $A$ is
\[ \ext(A) = \setof{ x | x\bowtie A } \]
It is less natural to rephrase the axioms of $\bowtie$ in terms of $\ext$, however.

\begin{thm}
  If $X$ is a prometric space, then the relations $\ll$, $\bowtie$, and $\approx$ from \cref{defn:toprels} make it into a topological neighborhood space, a topological apartness space, and a Moore closure space, plus a topological closure space if excluded middle holds.
\end{thm}
\begin{proof}
  In all cases, isotony and nullary additivity are obvious, while reflexivity follows directly from prometric reflexivity ($d(x,x)=0$).
  Binary additivity for $\ll$ and $\bowtie$ follow directly from the definitions of $\cap$ and $\cup$.

  Binary additivity for $\approx$, however, requires that if $\forall d,\forall \ep, \exists y\in A\cup B, d(x,y)<\ep$, then either $\forall d,\forall \ep, \exists y\in A, d(x,y)<\ep$ or $\forall d,\forall \ep, \exists y\in B, d(x,y)<\ep$.
  If excluded middle holds, we can prove this by contradiction: if neither of the two desired conclusions holds, then there are $d_1,\ep_1$ such that $d_1(x,y)\ge \ep_1$ for all $y\in A$, and also $d_2,\ep_2$ such that $d_2(x,y)\ge\ep_2$ for all $y\in B$.
  Then by binary filtration, there is a $d_3$ such that $d_1\le d_3$ and $d_2\le d_3$, and by assumption there is a $y\in A\cup B$ such that $d_3(x,y)<\min(\ep_1,\ep_2)$.
  But our assumptions show that this $y$ cannot be in $A$ or in $B$, a contradiction.
  Constructively, however, it seems impossible to prove this axiom.

  For transitivity for $\ll$, if $x\ll A$ then we have a $d,\ep$ with $d(x,y)<\ep \implies y\in A$.
  Let $d'$ be as in prometric transitivity for $d$; then if $d'(x,y)<\hfep$ and $d'(y,z)<\hfep$, we have $d(x,z) \le d'(x,y)+d'(y,z) <\ep$, so $z\in A$.
  Thus, $y\ll A$.
  Therefore, for any $y$ we have $d'(x,y)<\hfep \implies y\in \setof{ y | y\ll A }$, so $x\ll \setof{ y | y\ll A }$.
  Transitivity for $\bowtie$ and $\approx$ is analogous.
\end{proof}

In classical mathematics, all three notions of topological space are equivalent, via the following definitions (where $\cpl{A} = \setof{x\in X | x\notin A}$ means the relative complement of a subset $A\subseteq X$):
\[
\begin{array}{ccccc}
  x\ll A & \iff & x \bowtie \cpl{A} & \iff & x\napprox \cpl{A}\\
  x\bowtie A & \iff & x\napprox A & \iff & x \ll \cpl{A}\\
  x\approx A & \iff & x \not\ll \cpl{A} & \iff & x \not\bowtie A
\end{array}
\]
Constructively, this is no longer so, but we can say the following:

\begin{thm}\label{thm:toprels}\ 
  \begin{enumerate}
  \item If $X$ is a topological neighborhood space, define $x\approx A$ to mean
    \[\forall B, (x\ll B \implies A\cap B \text{ is inhabited})\]
    Then $X$ becomes a Moore closure space.\label{item:top-ll-wkcl}
    Its closed sets are called \textbf{weakly closed} in $X$.
  \item If $X$ is a topological neighborhood space, define $x\approx A$ to mean
    \[\forall B, (x\ll B \implies A\cap B \neq \emptyset)\]
    Then $X$ becomes a Moore closure space.\label{item:top-ll-strcl}
    Its closed sets are called \textbf{strongly closed} in $X$ (they are the complements of the open sets).
  \item If $X$ is a topological neighborhood space, define $x\bowtie A$ to mean $x\ll \cpl{A}$.
    Then $X$ becomes a topological apartness space.\label{item:top-ll-bowtie}
  \end{enumerate}
  Moreover, all these constructions are functorial.
\end{thm}
\begin{proof}
  In all cases, all the axioms are easy except binary additivity and transitivity.
  Binary additivity for~\ref{item:top-ll-wkcl} and~\ref{item:top-ll-strcl} fails constructively for essentially the same reason that it failed for prometric spaces, while for~\ref{item:top-ll-bowtie} it is easy since $\cpl{(A\cup B)} = \cpl{A} \cap \cpl{B}$.

  For transitivity of~\ref{item:top-ll-wkcl}, if $x\approx \setof{y | y\approx A}$, then whenever $x\ll B$, we also have $x\ll \int(B)$ by transitivity for $\ll$.
  Hence there is a $y\in \int(B)$ such that $y\approx A$; but then $y\ll \int(B)$, and so by definition of $\approx$ there is a $z\in\int(B)$ with $z\in A$.
  Since then $z\in B$ too, we have $x\approx A$.

  For transitivity of~\ref{item:top-ll-strcl}, let $x\approx \setof{y | y\approx A}$ and suppose for contraction that $x\ll B$ and $A\cap B =\emptyset$.
  Then also $x\ll \int(B)$ and $A\cap \int(B)=\emptyset$.
  We will show that $\setof{y | y\approx A} \cap \int(B) = \emptyset$, for which purpose suppose it contains an element $y$.
  But then $y\approx A$ and $y\in \int(B)$, hence $y\ll \int(B)$; thus by definition of $\approx$ we have $A\cap \int(B) \neq \emptyset$, a contradiction.

  For transitivity of~\ref{item:top-ll-bowtie}, suppose $x\bowtie A$, i.e.\ $x\ll \cpl{A}$; to show $x\bowtie \setof{y|\neg(y\bowtie A)}$ means to show $x\ll \setof{y|\neg\neg(y\bowtie A)} = \setof{y|\neg\neg(y\ll \cpl{A})}$.
  But $x\ll \setof{y|y\ll \cpl{A}}$ by transitivity for $\ll$, and $(y\ll \cpl{A})\implies\neg\neg(y\ll\cpl{A})$, so the result follows by isotony.

  For functoriality, suppose $X$ and $Y$ are topological neighborhood spaces and $f:X\to Y$ is $\ll$-continuous.
  If $x\approx A$ weakly, suppose given $B\subseteq Y$ with $f(x)\ll B$; then by $\ll$-continuity, we have $x\ll f\inv(B)$.
  Since $x\approx A$, we have $A\cap f\inv(B)$ inhabited, hence $f(A) \cap B$ inhabited.
  Thus, $f(x)\approx f(A)$.
  The proof for strong $\approx$ is essentially the same, and for $\bowtie$ it follows immediately from the fact that $f\inv(\cpl{A}) = \cpl{f\inv(A)}$.
\end{proof}

Since topological closure spaces fail to include the most interesting examples constructively, while Moore closure spaces don't contain enough topological information, we will say no more about closure spaces.
But topological neighborhood spaces and topological apartness spaces are both reasonable constructive notions.

There is a certain sense in which topological apartness spaces can be regarded as a subclass of topological neighborhood spaces, namely:

\begin{lem}\label{thm:top-bowtie-ll}
  If $X$ is a topological apartness space and we define $x\ll A$ to mean
  \begin{equation}
    \exists B, (x\bowtie B \land \forall y, (y\bowtie B \implies y\in A)),\label{eq:top-bowtie-ll-1}
  \end{equation}
  then $X$ becomes a topological neighborhood space.
  Moreover, we can reconstruct the original $\bowtie$ as in \cref{thm:toprels}\ref{item:top-ll-bowtie}.
\end{lem}
\begin{proof}
  As usual, the interesting axiom is transitivity.
  Thus, suppose $x\ll A$, witnessed by $B$ such that $x\bowtie B$ and $\forall y,(y\bowtie B \implies y\in A)$, i.e.\ $\setof{y|y\bowtie B} \subseteq A$.
  By transitivity for $\bowtie$, we have $x\bowtie \setof{y|y\not\bowtie B}$, so to show $x\ll \setof{y|y\ll A}$ it suffices to show $z\bowtie \setof{y|y\not\bowtie B} \implies z\in \setof{y|y\ll A}$.
  But if $z\bowtie \setof{y|y\not\bowtie B}$, then $z\bowtie B$ by isotony, and so $z\ll A$ by definition of $\ll$ and our assumption about $B$.
  
  For the second assertion, we have to show that $x\bowtie A$ is equivalent to
  \[\exists B, (x\bowtie B \land \forall y, (y\bowtie B \implies y\notin A)).\]
  This is certainly true if $x\bowtie A$ (take $B=A$).
  Conversely, the above assumption implies $A \subseteq \setof{y|y\not\bowtie B}$, so we have $x\bowtie A$ by isotony and transitivity.
\end{proof}

However, the construction of \cref{thm:top-bowtie-ll} is apparently not functorial: a $\bowtie$-continuous map need not induce a $\ll$-continuous map.
Thus, categorically it is at least dubious to regard topological apartness spaces as a subclass of topological neighborhood spaces.

There is a way to define $\ll$ in terms of $\bowtie$ that is functorial: let $x\ll A$ mean
\begin{equation}
  \exists B, (x\bowtie B \land \forall y, (y\in A \lor y\in B)).\label{eq:top-bowtie-ll-2}
\end{equation}
For if $f:X\to Y$ is $\bowtie$-continuous, i.e.\ $f(x)\bowtie f(A)$ implies $x\bowtie A$, and if we suppose $f(x)\ll C$, then we have by definition $B\subseteq Y$ with $f(x)\bowtie B$ and $\forall y, (y\in C \lor y\in B)$.
Since $f(f\inv(B))\subseteq B$, we have $f(x)\bowtie f(f\inv(B))$, so $x\bowtie f\inv(B)$.
Moreover, for all $y\in X$ we have $f(y)\in C$ or $f(y)\in B$, hence $y\in f\inv(C)$ or $y\in f\inv(B)$.
Thus, $f\inv(B)$ exhibits $x\ll f\inv(C)$, so $f$ is $\ll$-continuous.

However, \eqref{eq:top-bowtie-ll-2} apparently fails to satisfy transitivity in general, so it does not define a topological neighborhood space.
This suggests that a natural subclass of topological apartness spaces to compare with topological neighborhood spaces would be those for which these two definitions of $\ll$ coincide.\fxnote{Is there an adjunction or something else nicer?}
A natural condition that ensures this is the following.

\begin{defn}\ \fxnote{cite Bridges}
  \begin{enumerate}
  \item A topological apartness space $X$ is \textbf{locally decomposable} if whenever $x\bowtie A$, there is a subset $B$ such that $x\bowtie B$ and $\forall y, (y\in B \lor y\bowtie A)$.
  \item A topological neighborhood space $X$ is \textbf{locally decomposable} if whenever $x\ll A$, there is a subset $B$ such that $x\ll B$ and $\forall y, (y\notin B \lor y \ll A)$.
  \end{enumerate}
\end{defn}

Note that local decomposability (for both sorts of space) is actually a strengthening of transitivity.
The assumption $\forall y, (y\in B \lor y\bowtie A)$ gives $\setof{y|y\not\bowtie A} \subseteq B$, while the assumption $\forall y, (y\notin B \lor y \ll A)$ gives $B\subseteq \setof{y|y\ll A}$, so in both cases transitivity follows from isotony.

\begin{thm}\label{thm:top-locdec-equiv}
  The categories of
  \begin{enumerate}
  \item locally decomposable topological neighborhood spaces and
  \item locally decomposable topological apartness spaces
  \end{enumerate}
  are equivalent.
\end{thm}
\begin{proof}
  By \ref{thm:toprels}\ref{item:top-ll-bowtie}, we have a functor from neighborhood spaces to apartness spaces.
  We claim that local decomposability makes~\eqref{eq:top-bowtie-ll-1} and~\eqref{eq:top-bowtie-ll-2} coincide, giving a functor in the other direction.
  Evidently~\eqref{eq:top-bowtie-ll-2} always implies~\eqref{eq:top-bowtie-ll-1}.
  Conversely, suppose $x\ll A$ by~\eqref{eq:top-bowtie-ll-1}, so that $x\bowtie B$ and $\forall y, (y\bowtie B \implies y\in A)$.
  By local decomposability we have a $C$ with $x\bowtie C$ and $\forall y, (y\in C \lor y\bowtie B)$; but then $\forall y, (y\in C \lor y\in A)$, giving~\eqref{eq:top-bowtie-ll-2}.

  It remains to show that local decomposability is preserved in both directions, and that the round-trip composite is the identity on locally decomposable neighborhood spaces.
  Suppose first that $\ll$ is locally decomposable and $x \bowtie A$, so that $x\ll \cpl{A}$; then we have a $B$ with $x\ll B$ and $\forall y, (y\notin B \lor y\ll \cpl{A})$.
  Let $C = \cpl{B}$; then $x\ll \cpl{C}$ by isotony, i.e.\ $x\bowtie C$.
  Moreover, any $y$ satisfies either $y\ll\cpl{A}$, i.e.\ $y\bowtie A$, or $y\notin B$, i.e.\ $y\in C$.
  Thus, $\bowtie$ is locally decomposable.

  On the other hand, suppose $\bowtie$ is locally decomposable and $x\ll A$, so that (by~\eqref{eq:top-bowtie-ll-2}) we have a $B$ with $x\bowtie B$ and $\forall y, (y\in A \lor y\in B)$.
  Then by local decomposability for $\bowtie$ we have a $C$ with $x\bowtie C$ and $\forall y, (y\in C \lor y\bowtie B)$.
  Using it again, we have a $D$ with $x\bowtie D$ and $\forall y, (y\in D \lor y\bowtie C)$.
  Thus $D$ exhibits $x\ll \setof{y|y\bowtie C}$.
  Let $z\in X$; it remains to show $z\ll A$ or $z\notin \setof{y|y\bowtie C}$.
  We have either $z\in C$ or $z\bowtie B$, and if $z\bowtie B$ and hence $z\ll A$ (exhibited by $B$).
  But if $z\in C$, then $z\not\bowtie C$, hence $z\notin \setof{y|y\bowtie C}$.

  Finally, suppose given a locally decomposable $\ll$; we must show that $x\ll A$ if and only if
  \[ \exists B, (x\ll \cpl{B} \land \forall y, (y\in A \lor y\in B)) \]
  This statement clearly implies $\cpl{B}\subseteq A$, hence $x\ll A$ by isotony.
  Conversely, if $x\ll A$ then we have a $C$ with $x\ll C$ and $\forall y, (y\ll A \lor y\notin C)$, since $\ll$ is locally decomposable.
  Let $B = \cpl{C}$; then $x\ll \cpl{B} = \cpl{\cpl{C}}$ by isotony,
  and any $y$ satisfies either $y\ll A$ (hence $y\in A$) or $y\notin C$ (hence $y\in B$).
\end{proof}

Local decomposability is classically trivial (take $B=\setof{y|y\bowtie A}$ for $\bowtie$, or $B=A$ for $\ll$).
Constructively, it is an extra condition, but is not too strong; it is satisfied by any prometric space.

\begin{thm}
  The $\bowtie$ and $\ll$ underlying any prometric space are locally decomposable, and identified with each other by the equivalence of \cref{thm:top-locdec-equiv}.
  Moreover, this defines a fully faithful functor from prometric spaces and continuous functions to the category of \cref{thm:top-locdec-equiv}.
\end{thm}
\begin{proof}
  Let $X$ be a prometric space; we first show that $x\bowtie A$ if and only if $x\ll \cpl{A}$ according to \cref{defn:toprels}, so that the two structures correspond under \cref{thm:top-locdec-equiv}.
  If $x\bowtie A$, we have $d,\ep$ such that $y\in A \implies d(x,y)>\ep$ for any $y$.
  By a contrapositive, it follows that $d(x,y)\le \ep \implies y\notin A$, giving $x\ll \cpl{A}$.
  Conversely, if $x\ll\cpl{A}$, we have $d,\ep$ such that $d(x,y)< \ep \implies y\notin A$ for any $y$.
  The contrapositive is now $\neg\neg(y\in A) \implies d(x,y)\ge \ep$, which implies $y\in A \implies d(x,y)> \hfep$, so $x\bowtie A$.

  For local decomposability, let $x\ll A$ so we have $d,\ep$ with $d(x,y)< \ep \implies y\in A$ for any $y$.
  Let $d'$ be as in prometric transitivity for $d$, and let $B = \setof{y|d'(x,y)<\hfep}$; then $x\ll B$ is exhibited by $d',\hfep$.
  Now for any $y$, we have either $d'(x,y)<\frac{2\ep}{3}$ or $d'(x,y)>\hfep$.
  In the former case $y\ll A$ is exhibited by $d'$ and $\frac{\ep}{3}$, since if $d'(y,z)<\frac{\ep}{3}$ then $d(x,z)<\ep$ so $z\in A$.
  And in the latter case $y\notin B$ by definition.

  Finally, let $X$ and $Y$ be prometric spaces and $f:X\to Y$ a function.
  Suppose first that $f$ is prometrically continuous, and let $f(x)\ll A$, so that we have $d_Y,\ep$ with $d_Y(f(x),y)< \ep \implies y\in A$ for any $y\in Y$.
  By continuity, there is a $d_X$ and a $\de$ such that $d_X(x,x')<\de \implies d_Y(f(x),f(x'))<\ep$ for any $x'\in X$, and hence $d_X(x,x')<\de \implies x'\in f\inv(A)$.
  Thus $x\ll f\inv(A)$, so $f$ is $\ll$-continuous.

  On the other hand, if $f$ is $\ll$-continuous, for any $x$ and any $d_Y,\ep$ we have $f(x)\ll \setof{y|d_Y(f(x),y)<\ep}$.
  Thus $x\ll \setof{x'|d_Y(f(x),f(x'))<\ep}$, which means (by definition of $\ll$) we have $d_X,\de$ such that $d_X(x,x')<\de \implies d_Y(f(x),f(x'))<\ep$, giving prometric continuity.
\end{proof}

Henceforth we will simply speak of a \textbf{locally decomposable topological space}, which comes with both a $\ll$ and a $\bowtie$ that are interdefinable.
Such spaces thus fully capture the topological structure of prometric spaces, where ``topological structure'' is defined by the notion of continuous function.

Of course, even topologically prometric spaces are very special among the topological spaces, and much of their specialness is captured by \emph{separation axioms}.
Local decomposability itself is naturally regarded as a separation axiom, albeit one that is only nontrivial constructively.

We will not exhaustively survey separation axioms, but there are a few others worth mentioning.
The first two are naturally phrased using the fact that point-set relations give rise to point-point relations.

\begin{thm}\ 
  \begin{enumerate}
  \item If $X$ is a topological neighborhood space, define $x\leapx y$ to mean that $\forall A, (x\ll A \to y\ll A)$.
    Then $\leapx$ is a preorder.
  \item If $X$ is a topological apartness space, define $x\oapt y$ to mean $x \bowtie \singleton{y}$.
    Then $\oapt$ is irreflexive, and if $X$ is locally decomposable then it is a comparison.
  \end{enumerate}
  Moreover, if $X$ is a prometric space then both of these relations agree with those defined in \cref{def:promet-ord}.
\end{thm}
\begin{proof}
  In the neighborhood case, reflexivity and transitivity of $\leapx$ follow directly from reflexivity and transitivity of $\implies$.
  If $X$ is a prometric space and $\forall d, d(x,y)=0$, then whenever $x\ll A$ we have $d,\ep$ with $d(x,z)<\ep \implies z\in A$ for any $z$.
  Let $d'$ be as in prometric transitivity for $d$; then $d'(x,y)=0$, so if $d'(y,z)<\ep$ we have $d(x,z)<\ep$, hence $z\in A$.
  Thus $d',\ep$ exhibit $y\ll A$.

  In the apartness case, irreflexivity is obvious.
  For the comparison axiom, we note first that local decomposability implies the following property that we call \textbf{weak local decomposability}: if $x\bowtie A$, then $\forall y, (x\bowtie \singleton{y} \lor y\bowtie A)$.
  This follows from isotony: if $x\bowtie B$ and $y\in B$, then $x\bowtie \singleton{y}$.
  Moreover, weak local decomposability implies that $\oapt$ is a comparison, by taking $A = \singleton{y}$.
  Finally, if $X$ is a prometric space and we have a $d$ with $d(x,y)>0$, then taking $\ep=\frac12 d(x,y)$ we find $x\bowtie \singleton{y}$.
\end{proof}

\begin{defn}
  Let $X$ be a topological neighborhood space.
  \begin{enumerate}
  \item $X$ is $\mathbf{T_1}$ if $x\leapx y \implies x=y$.
  \item $X$ is $\mathbf{R_0}$ if $\leapx$ is symmetric (hence an equivalence relation).
  \end{enumerate}
  Let $X$ be a topological apartness space.
  \begin{enumerate}
  \item $X$ is $\mathbf{T_1}$ if $\neg(x\oapt y)\implies x=y$ (i.e.\ $\oapt$ is tight).
  \item $X$ is $\apart$-$\mathbf{T_1}$ if $x\apart y \implies x\oapt y$, for some tight relation $\apart$.
  \item $X$ is \textbf{strongly} $\mathbf{R_0}$ if $\oapt$ is symmetric (hence an apartness relation).
  \end{enumerate}
\end{defn}

Note that if an apartness space is $T_1$, then it is $\oapt$-$T_1$, while conversely $\apart$-$\mathbf{T_1}$ for some tight $\apart$ implies $T_1$.

\begin{thm}
  If $X$ is a locally decomposable topological space, then for any $x,y\in X$ we have
  \[ (x\leapx y) \iff \neg(x\oapt y) \]
  and the two definitions of $T_1$ above agree, while strong $R_0$ implies $R_0$.
\end{thm}
\begin{proof}
  First let $x\leapx y$, so that $\forall A, (x\ll A \implies y\ll A)$, and suppose for contradiction that $x\oapt y$, i.e.\ $x\bowtie \singleton{y}$.
  The latter means by definition that $x\ll \cpl{\singleton{y}}$, so by assumption we have $y\ll \cpl{\singleton{y}}$, a contradiction since $y\notin \cpl{\singleton{y}}$.

  On the other hand, suppose $\neg(x\oapt y)$, and let $x\ll A$; we will show $y\ll A$.
  By local decomposability we have a $B$ with $x\ll B$ and $\forall z, (z\ll A \lor z\notin B)$.
  Thus, to show $y\ll A$ it suffices to show that $y\notin B$ leads to a contradiction.
  But if $y\notin B$ then $B\subseteq \cpl{\singleton{y}}$, so $x\ll \cpl{\singleton{y}}$ by isotony and thus $x\bowtie \singleton{y}$, contradicting $\neg(x\oapt y)$.

  The remaining statements are obvious.
\end{proof}

\begin{thm}
  Let $X$ be a prometric space.
  \begin{enumerate}
  \item $X$ is separated if and only if it is $T_1$.
  \item If $X$ is symmetric, then its underlying topology is strongly $R_0$.
  \end{enumerate}
\end{thm}
\begin{proof}
  Obvious.
\end{proof}

Regularity (any symmetric prometric space) and complete regularity (any symmetric gauge space)


\section{Filters of point-point relations: uniformity}
\label{sec:uniformity}


TODO: Upper prometric spaces are equivalent to uniform spaces; lower prometric spaces are equivalent to uniform apartness spaces.


\section{Approach spaces and filters of point-set relations}
\label{sec:approach}



\section{Set-set relations: proximity}
\label{sec:set-set}
\label{sec:proximity}



\section{Filters of set-set relations: syntopogeny}
\label{sec:syntop}



\section{Located subspaces}
\label{sec:located}

\begin{defn}
  A subset $A\subseteq X$ is \textbf{(metrically) located} if for all $x\in X$, the set $\setof{ d(x,y) | y\in A }$ has an greatest lower bound, written $d(x,A)$.
  \fxwarning{Which direction does this go in the quasi case?}
\end{defn}

Classically, the poset $\Rp$ is a complete lattice, and thus every subset is located.
(Even the empty set: $d(x,\emptyset)=\infty$.
This is one good reason for allowing infinite distances.)
However, constructively there are ``wild'' subsets such as $\setof{x\in X | P}$, for some undecidable proposition $P$, that cannot be shown to be located in general.
\fxnote{Mention some theorems about located subsets.}

Note: approach spaces have a distance between points and sets, definable from a metric space by infima.
Constructively this produces only an upper-real-valued distance, unless all subsets are located.
Presumably there are ``pro-approach spaces'' that arise from prometric spaces, or at least from gauge spaces.
Upper pro-approach spaces also give rise to syntopogenous spaces, but not decomposable ones.


\bibliographystyle{alpha}
\bibliography{syntop}

\end{document}
